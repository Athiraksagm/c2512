#include<iostream>
#include<sstream>
#include<string>

#include "./../headers/payment_main.h"
#include "./../headers/ui_common.h"

class PaymentController 
{ 
    public: 
        static void Read(std::string& appointment_Number, int flags = 3) {
            if((flags & 1) != 0) {
                std::cout << "Appointment Number  : "; std::cin >> appointment_Number;
            }
        }
        void makePayment(){
          uiCommon.TitleBar("Admin App > Payment Management > Make Payment");
            int flags = 3;
            std::string appointment_Number;
            
            
            do {
                Read(appointment_Number, flags);
                int proceedOption; 

                std::stringstream soutput;
                soutput << "Your consultation fee is : 500 "<< std::endl;
                soutput << "91 - Continue Payment." << std::endl;
                soutput << "\tYour choice:"; 
                proceedOption = uiCommon.in.Int(soutput.str());

                if(91 == proceedOption) {
                    //set to biz object
                    break;
                }
                flags = proceedOption;
            } while(true);
            std::cout << "Payment mode : UPI" << std::endl;
            std::cout << "Payment completed successfully." << std::endl;
            uiCommon.PressAnyKey(true);        
        }

        
        void View() {
            uiCommon.TitleBar("Admin App > Payment Management > View Payment Details");
            int flags = 3;
            std::string appointment_Number;
            
            
            do {
                Read(appointment_Number, flags);
                int proceedOption; 

                std::stringstream soutput;   
                soutput << "91 - Proceed." << std::endl;
                soutput << "\tYour choice:"; 
                proceedOption = uiCommon.in.Int(soutput.str());

                if(91 == proceedOption) {
                    //set to biz object
                    break;
                }
                flags = proceedOption;
            } while(true);
            std::cout << "Appointment Id : Apt5001" << std::endl;
            std::cout << "Payment amount : 500" << std::endl;
            std::cout << "Payment mode : UPI" << std::endl;
            std::cout << "Payment status : Paid" << std::endl;
            std::cout << "Payment Date and time : 2025-01-22 10:00" << std::endl;
            std::cout << "Payment details viewed successfully." << std::endl;
            uiCommon.PressAnyKey(true);        
        }
        
};

static int ReadPaymentMenu() {
    int choice;
    
    uiCommon.TitleBar("Admin App > Payment Management");

    std::stringstream soutput;
    soutput << "1 - Make Payment " << std::endl;
    soutput << "2 - View Payment Details" << std::endl;
    soutput << "99 - Exit" << std::endl;
    soutput << "Your choice:"; 
    choice = uiCommon.in.Int(soutput.str()); //std::cin >> choice;
    
    uiCommon.Line('~');
    uiCommon.PressAnyKey(true); 
    return choice;
}

void ManagePayment() { 
    PaymentController controller;
    
    int choice;

    do { 
        choice = ReadPaymentMenu();
        switch(choice) {
            case 99: {
                std::cout << "Exited successfully.." <<std::endl;
            } break;
            case 1: {
                controller.makePayment();
            } break;
             case 2: {
                controller.View();
            } break;
        }
    } while(99 != choice);
}
